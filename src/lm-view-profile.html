<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel = 'import' href='../bower_components/polymer/polymer.html'>
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="lm-view-progress.html">
<link rel = "import" href = "../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel = "import" href = "../bower_components/paper-item/paper-item.html">
<link rel = "import" href = "../bower_components/paper-listbox/paper-listbox.html">
<link rel = "import" href = "../bower_components/paper-button/paper-button.html">
<link rel = "import" href = "../bower_components/paper-styles/paper-styles.html">
<link rel = "import" href="../bower_components/iron-icons/iron-icons.html">
<link rel = "import" href = "../bower_components/paper-input/paper-input.html">
<link rel = "import" href = "../bower_components/paper-checkbox/paper-checkbox.html">
<link rel = "import" href = "../bower_components/paper-alert-dialog/paper-alert-dialog.html">
<link rel = "import" href = "../bower_components/iron-autogrow-textarea/iron-autogrow-textarea.html">
<script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<link rel="import" href="../bower_components/paper-spinner/paper-spinner-lite.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"> 
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/scale-down-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">

<dom-module id="lm-view-profile">
  <template>
   <style include="shared-styles">
      :host {
        /* display: block; */
        padding: 10px;
      }
      .separate_sec{margin-bottom: -17px;}
        .val_dropdown
        {
        display: inline;
        }
        .close-dialog {    position: absolute;
          top: -12px;
          right: -31px;}
        .dep_dropdown
        {
          overflow: hidden;box-sizing: border-box;max-width: 77.4844px;max-height: 294.078px;
        }
        .bsn_width{    width: 65%;    margin-top: -14%; margin-bottom: -17px;}
        .icon_space{margin-right: 10px;}
        /* .icon_space_mail{} */
        .icon_mandatory_mail{margin-right: 4px; color: #ff0000}
        .icon_mandatory{margin-right: 4px; color: #ff0000}
        #container {display: flex;}
        paper-button{ padding: 10px; border-radius: 5px; float: right;}
        paper-button[disabled]{ cursor: no-drop!important; pointer-events: all !important; background: #F3C5C5}
        paper-button[hover][active]{background: red!important;}
        paper-button.green:hover { background-color: var(--paper-green-400);}
        paper-button.green { background-color: var(--paper-green-500); color: white;}
        paper-button.green[active] {background-color: var(--paper-red-500);}
        .style-scope.lm-view-profile {height: auto;}
         .input_width_email{width:105%;margin-top:-22%;margin-bottom:-7%;} 
        .next_button {overflow: auto;}
        .row {display: flex;}
        .col {flex: 1; padding: 18px 0 25px 50PX;}
        .contact_div {margin-top: -4%;}
        .confirm_info{font-size: 14px;        }
        .input_width{width:65%;margin-bottom: -10%;margin-top:1%;}
        .input_width_incm{width:65%;margin-bottom: -5%;margin-top:-2%;}
        .input_width_add{width:65%;margin-bottom: 10%;margin-top:1%;}
        .input_width_loc{width:65%;margin-bottom: 10%;margin-top:-22%;}
        .input_width_post{width:65%;margin-bottom: 10%;margin-top:-22%;}
        .User_details{margin:0px auto;width:60%;}

        .User_details paper-dropdown-menu{margin-bottom: 0;}
        paper-dropdown-menu.salutation{width: 48%;}
        .men_btn{display: block;
    padding: 3px;}
        .Salutation_detail{height: 50px;width:65%;}
        paper-dropdown-menu.Marital_Status{width:65%;margin-top: -7px;}
        paper-dropdown-menu.dependents{width:65%;margin-top:-7px;}
        paper-dropdown-menu.mob_code{width:17%;padding-right: 3px}
		    :host paper-input[disabled] {
        --paper-input-container-input-color: #afafaf;
        --paper-input-container-label:{border:1px solid red;};
        --paper-input-container-disabled: {
        opacity: 0.7;

        }
        }
        :host paper-dropdown-menu[disabled] {
        --paper-input-container-input-color: #afafaf;
        --paper-input-container-disabled: {

        opacity: 0.7;

        }
        } 
        paper-spinner-lite {
          --paper-spinner-color: #FF6600;
          position: absolute;
          top: 290px;
          left: 600px;
        }
        paper-dialog {
          border: 2px solid #777777;
          border-radius: 5px;
          padding: 1%;
          width: 40%;
          height: auto;
          font-size: 15px;
        }
        #cover{position: fixed;top:0;left:0;background: rgba(0,0,0,0.6);z-index: 5;width:100%;height: 100%;display: none;}
 
          .mob_code {width: 22%; float: left;}
          .mobile_number {padding: 1px 0 0 0;}
          .declaration_text{margin:30px 0px 8px;font-size:14px;}
          paper-spinner-lite.active{position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);} 
    </style>
	
    <iron-ajax
               auto
               url="{{getProfileUrl}}"
               handle-as="json"
               on-response = "handleResponse"
               >
    </iron-ajax>
    <iron-ajax
              id="knockOutAjax"
              url="{{getKnockOutUrl}}"
              on-response="knockOutResponse"
              handle-as="json"
              content-type="application/json">
  </iron-ajax>
    
    <iron-ajax
      id="saveProfile"
      url="http://10.138.64.19:8080/lightningmortgage/customer/editCustomer"
      handle-as="json"
      method = "POST"
      on-response = "updateEditProfile"
      body='{{ajaxResponse}}'
      content-type = "application/json"
      >
    </iron-ajax>

<iron-form id="userForm">
  <form>
    <div class="card User_details">     
    <paper-spinner-lite active$="{{isActive}}" class="orange active"></paper-spinner-lite> 
    <div class="confirm_info"><iron-icon icon="icons:verified-user" class="icon_space" slot="prefix"></iron-icon>
      {{localize('profile.headerDeclaration')}}
    </div>       
        <h3><iron-icon icon="account-box" class="icon_space" slot="prefix"></iron-icon>
          {{localize('profile.ContentHeader')}}</h3><hr class="separate_sec">        
        <div class="row Salutation_detail"> 
          <div class="col"> 
                <paper-dropdown-menu class="salutation" label="{{localize('profile.Salutation')}}" value="{{ajaxResponse.salutation}}" >
                    <paper-listbox  selected="{{selectedSalutaion}}" slot = "dropdown-content" class="val_dropdown">
                      <paper-item value="Mr.">{{localize('profile.salutation_Mr')}}</paper-item>
                      <paper-item value="Mrs.">{{localize('profile.salutation_Mrs')}}</paper-item>
                    </paper-listbox>
                  </paper-dropdown-menu>
          </div>
        </div>
          <div class="row"> 
              <div class="col"> 
                <paper-input class="input_width" required auto-validate error-message="{{localize('profile.Err_Firstname')}}" id="firstName"autocapitalize allowed-pattern="[a-zA-Z]" 
                label = "{{localize('profile.Firstname')}}" value="{{ajaxResponse.firstName}}">
                  <iron-icon icon = "account-circle"  prefix></iron-icon>
                  <div class="icon_mandatory" slot="prefix">*</div>
                </paper-input>
              </div>
              <div class="col"> 
                <paper-input class="input_width" auto-validate error-message="{{localize('profile.Err_Lastname')}}" autocapitalize allowed-pattern="[a-zA-Z]" 
                  label="{{localize('profile.Lastname')}}" required value= "{{ajaxResponse.lastName}}">
                </paper-input>
              </div>
          </div>
          <div class="row">
            <div class="col">  
                <paper-dropdown-menu auto-validate error-message="{{localize('profile.Err_MaritalStatus')}}" 
                class="Marital_Status" label="{{localize('profile.MaritalStatus')}}"  value="{{ajaxResponse.maritalStatus}}" 
                 required auto-validate>
                 <div class="icon_mandatory" slot="prefix">*</div>
                  <paper-listbox  selected="{{selectedMaritalStatus}}" slot = "dropdown-content" class="val_dropdown">
                      <paper-item value="Single">{{localize('profile.Single')}}</paper-item>
                      <paper-item value="Married">{{localize('profile.Married')}}</paper-item>
                      <paper-item value="Divorced">{{localize('profile.Divorcee')}}</paper-item>
                    </paper-listbox>
                  </paper-dropdown-menu>
            </div>
            <div class="col">
                <paper-dropdown-menu required auto-validate 
                error-message="{{localize('profile.Err_dependents')}}" 
                class="dependents" label="{{localize('profile.Dependents')}}"  value="{{ajaxResponse.noOfDependents}}">
                    <paper-listbox  selected="{{ajaxResponse.noOfDependents}}" slot = "dropdown-content" class="dep_dropdown">
                      <paper-item value="0">0</paper-item>
                      <paper-item value="1">1</paper-item>
                      <paper-item value="2">2</paper-item>
                      <paper-item value="3">3</paper-item>
                      <paper-item value="4">4</paper-item>
                      <paper-item value="5">5</paper-item>
                      <paper-item value="6">6</paper-item>
                    </paper-listbox>
                </paper-dropdown-menu>
              </div>
          </div>
          <div class="row">
            <div class="col">
              <paper-input class="bsn_width" readonly label="{{localize('profile.Bsn')}}" value="{{ajaxResponse.bsn}}">
              </paper-input>
            </div>
            <div class="col"></div>
          </div>

          <h3><iron-icon icon="home" class="icon_space" slot="prefix"></iron-icon>
            {{localize('profile.AddressDetails')}}</h3><hr class="separate_sec">
          <div class="row">
            <div class="col">  
              <paper-input class="input_width_add"label="{{localize('profile.DoorNumber')}}" required auto-validate error-message="{{localize('profile.DoorNumber')}}" 
              value="{{ajaxResponse.address.doorNumber}}">
              </paper-input>
            </div>
            <div class="col">
                <paper-input class="input_width_add"label="{{localize('profile.StreetName')}}" required auto-validate error-message="{{localize('profile.StreetName')}}" value="{{ajaxResponse.address.addressLine1}}">
                </paper-input>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <paper-input class="input_width_loc" label="{{localize('profile.Locality')}}" required auto-validate error-message="{{localize('profile.Err_Locality')}}" 
              value="{{ajaxResponse.address.addressLine2}}">
                  <iron-icon icon = "account-circle"  prefix></iron-icon>
                </paper-input>
            </div>
            <div class="col"></div>
          </div>
          <div class="row">
            <div class="col">
              <paper-input class="input_width_post" id="abc"type="text" required 
              auto-validate error-message="{{localize('profile.Err_PostCode')}}" 
              label="{{localize('profile.PostCode')}}" 
                value="{{ajaxResponse.address.postCode}}" on-blur="getCityInfo"><div class="icon_mandatory" slot="prefix">*</div></paper-input>
            </div>
            <div class="col">
                <paper-input class="input_width_post" readonly id="cityName" 
                label="{{localize('profile.City')}}" 
                value="{{ajaxResponse.address.city}}"></paper-input>

            </div>
          </div>

          <h3 class="contact_div">
            <iron-icon icon="settings-phone" class="icon_space" slot="prefix"></iron-icon>
            {{localize('profile.ContactDetails')}}</h3><hr class="separate_sec">
            <div class="row Contact_details">  
              <div class="col"> 
                <paper-input class="input_width" label="{{localize('profile.HomeNumber')}}" required auto-validate error-message="{{localize('profile.Err_HomeNumber')}}"
                 value="{{ajaxResponse.homeNumber}}" 
                  type="number">
                  <div slot="prefix"></div>
                </paper-input>
              </div>                
                <div class="col mob_number">
                  <div class="mob_code">
                    <paper-dropdown-menu class="men_btn" label="{{localize('profile.Code')}}" 
                     value="{{ajaxResponse.mobileCode}}">
                        <paper-listbox selected="{{selectedmobileCode}}" slot = "dropdown-content" >
                          <paper-item value="+31">+31</paper-item>
                          <paper-item value="+91">+91</paper-item>
                        </paper-listbox>
                      </paper-dropdown-menu>
                  </div>
                  <div class="mobile_number">
                    <paper-input class="input_width"required auto-validate 
                    error-message="{{localize('profile.MobileNumber')}}"  maxlength="10" 
                    label="{{localize('profile.MobileNumber')}}" value="{{ajaxResponse.mobileNumber}}" 
                    type="number"><div class="icon_mandatory" slot="prefix">*</div><div slot="prefix"></div>
                    </paper-input>
                </div>
              </div>
            </div>
            <div class="row">  
              <div class="col">
                
                <paper-input class="input_width_email" 
                label="{{localize('profile.EmailAddress')}}" required auto-validate 
                error-message="{{localize('profile.Err_EmailAddress')}}" 
                  value="{{ajaxResponse.emailAddress}}">
                  <iron-icon icon="mail" class="icon_space" slot="prefix"></iron-icon>
                  <!-- <div class="icon_mandatory_mail" slot="prefix">*</div> -->
                </paper-input>
              </div>
              <div class="col"></div><div class="col"></div>
            </div>

          <h3><iron-icon icon="account-balance" class="icon_space" slot="prefix"></iron-icon>
            {{localize('profile.FinanceDetails')}}</h3><hr class="separate_sec">
          <div class="row">
            <div class="col">
              <paper-input required auto-validate error-message="{{localize('profile.Err_Income')}}" class="input_width" label="{{localize('profile.Income')}}" step="200" value="{{ajaxResponse.monthlyFamilyIncome}}" type="number">
                   <div slot="prefix"class="icon_space">€</div>
              </paper-input>
            </div>
            <div class="col">
              <paper-input  required auto-validate error-message="{{localize('profile.Err_MonthlyExpense')}}" class="input_width" label="{{localize('profile.MonthlyExpense')}}" step="200" value="{{ajaxResponse.monthlyFamilyExpense}}" type="number">
                <div slot="prefix" class="icon_space">€</div>
              </paper-input>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <paper-input class="input_width_incm" label="{{localize('profile.IncomeAdditional')}}" step="200" value="{{ajaxResponse.monthlyFamilyIncomeAdditonal}}" type="number">
                <div slot="prefix" class="icon_space">€</div>
              </paper-input>
            </div>
            <div class="col"></div>                
          </div>
          <div class="declaration_text">
      <paper-checkbox name="read" on-change ="sub" required>
        {{localize('profile.SubmitDeclaration')}}</paper-checkbox>
            </div>
        <div id="cover"></div>    
        
          <paper-dialog id="validateText" no-cancel-on-outside-click entry-animation="scale-up-animation"
          exit-animation="scale-down-animation">
              <div on-click="closeDialog">
                  <paper-icon-button icon="icons:cancel" title="Close" dialog-dismiss></paper-icon-button>
              </div>
              <h2>{{localize('profile.KnockoutFailed1')}}</h2>
              <label>{{localize('profile.KnockoutFailed2')}}</label>
              <ul>
                <li><label><a href="">{{localize('profile.KnockoutFailed3')}}</a></label></li>
                <li><label>{{localize('profile.KnockoutFailed4')}}</label></li>
              </ul>
              
              <paper-button class="custom dialog-orange" on-click="closeDialog" dialog-dismiss>
                  {{localize('profile.Ok')}}
                </paper-button>               
          </paper-dialog>

          <paper-dialog id="confirmText" no-cancel-on-outside-click entry-animation="scale-up-animation"
          exit-animation="scale-down-animation">
              <div on-click="closeDialog">
                  <paper-icon-button icon="icons:cancel" title="Close" dialog-dismiss></paper-icon-button>
              </div>
             <label> {{localize('profile.ConfirmText1')}} </label>
             <label>{{localize('profile.ConfirmText2')}} </label>
            <paper-button class="custom dialog-orange" on-click="knockOutCheck" dialog-dismiss>
                {{localize('profile.Ok')}}
              </paper-button>               
          </paper-dialog>

        <div class="next_button">
          <paper-spinner-lite active$="{{loader}}" class="orange active"></paper-spinner-lite>
          <paper-button toggles raised class = "" on-tap="cancel"> 
            {{localize('profile.Cancel')}}</paper-button>
          <!-- <paper-button hidden$="{{hide}}" toggles raised class ="" on-tap="knockOutCheck">Validate</paper-button>       -->
   <paper-button disabled$="{{!checked}}" toggles raised class = "" on-tap="updateProfile">
     {{localize('profile.Validate')}}</paper-button> 
        </div>
    </div>
  </form>
</iron-form>
    
    <iron-ajax id="cityInfoReq" url={{postCodeApiUrl}} method="GET"
        body='{{postalCodeInfo}}' handle-as="json" on-response="handleCityInfoResponse">
    </iron-ajax>
    
  </template>

  <script>
    class ViewProfile extends LmGlobal {
      static get is() { return 'lm-view-profile'; }
      static get properties() {
        return {
          prop1: {
            type: String,
            value: "bar"
          },
          id:{
            type:String

          },
          lastName: {
            type: String,
            value: "William"
          },
          firstName: {
            type: String,
            value: "Andrew"
          },
          selectedSalutaion:{
            type:String,
            value:"3"
          },
          bSN:{
            type:String,
            value:"BSN"
          },
          doorNumber:{
            type:String,
            value:"22"
          },
          addressLine1:
          {
            type:String,
            value:"Netherlands---------------"
          },
          addressLine2:
          {
            type:String,
            value:"Netherlands---------------"
          },
          city:{
            type:String,
            value:"Amsterdam"
          },
          homeNumber:{
            type:String,
            value:"Amsterdam"
          },
          selectedmobileCode:{
            type:String,
            value:"4"
          },
          emailAddress:{
            type:String,
            value:"abc@gmail.com"
          },
          selectedMaritalStatus:{
            type:String,
            value:"3"
          },
          noOfDependents:
          {
            type:String,
            value:"1"
          },
          getProfileSave:{
            type:String,
            computed : 'saveProfile(id, emailAddress)'
          },
          getProfileUrl: {
            type: String,
            computed: 'getUrl()'
          },
          getKnockOutUrl: {
            type: String,
            computed: 'getKnockUrl()'
          },
          ajaxResponse : {
            type : Object,
            value : {}
          },
          tempResponse : {
            type : Object,
            value : {}
          },
          edit :{
            type:Boolean,
            value: false
          },
          checked:{
            type:Boolean,
            value:false
          },
          hide:{
            type:Boolean,
            value:false
          },
          loader:{
            type : Boolean,
            value : false
          }
        }
      }
      eventClick() {
        this.edit = true;
        this.hide=true;
        this.$.lmDialog.open();
      }
      updateProfile(e){
        let Fname = this.ajaxResponse.firstName
        let Pcode = this.ajaxResponse.address.postCode;
        let mobile = this.ajaxResponse.mobileNumber;
       console.log("dssd"+mobile);
       if((mobile != "") && (Fname != "") && (Pcode != "")){
         console.log("inside");
        if(this.checked)
        {
          this.$.saveProfile.generateRequest();
          this.loader = true;
          this.$.cover.style.display="block";
        }
       }
      
    

      }
      closeDialog()
      {
        this.loader = false;
        this.$.cover.style.display="none";
      }
      saveProfile(){
        this.edit=false;
        this.hide = false;
        if(this.checked)
        {
          return this.ajaxResponse;
        }
        
      }
      handleResponse(data) {
       
          this.ajaxResponse = data.detail.response ;
          this.tempResponse  = JSON.parse(JSON.stringify(data.detail.response));
          if(this.ajaxResponse) {
            if(this.ajaxResponse && this.ajaxResponse.salutation=='Mr.') {
              this.selectedSalutaion = "0";
            }else if(this.ajaxResponse && this.ajaxResponse.salutation=='Mrs.') {
              this.selectedSalutaion = "1";
            }
            if(this.ajaxResponse && this.ajaxResponse.maritalStatus=='Single') {
              this.selectedMaritalStatus = "0";
            }else if(this.ajaxResponse && this.ajaxResponse.maritalStatus=='Married') {
              this.selectedMaritalStatus = "1";
            }else if(this.ajaxResponse && this.ajaxResponse.maritalStatus=='Divorced') {
              this.selectedMaritalStatus = "2";
            }
            if(this.ajaxResponse && this.ajaxResponse.mobileCode=='+31.') {
              this.selectedmobileCode = "0";
            }else if(this.ajaxResponse && this.ajaxResponse.mobileCode=='+91') {
              this.selectedmobileCode = "1";
            }
          }
          
         // this.tempResponse = data.detail.response;
        
      }
            getCityInfo(){
              let postCode = this.ajaxResponse.address.postCode;
               if(postCode!="undefined" && postCode!="")
               this.postCodeApiUrl = "http://10.138.64.19:8080/lightningmortgage/city/"+postCode;
              this.$.cityInfoReq.generateRequest();
            }
     
      handleCityInfoResponse(res){
              let valid = res.detail.response.valid;
              if(valid){
                this.$.cityName.value = res.detail.response.result;
                //this.propertydetails["propCity"] = res.detail.response.result;
              } else {
                this.$.cityName.value = "";
              }
              this.isActive = false;
            }
      cancel() {
        this.ajaxResponse = this.tempResponse;
        this.edit=false;
        this.hide = false;
        return this.ajaxResponse;
      }
      sub()
      {
          this.checked= !this.checked;
        
      }

      getUrl() {
        var userId=localStorage.getItem('userId');
        return "http://10.138.64.19:8080/lightningmortgage/customer/getCustomer/"+userId;
        
      }
      getKnockUrl() {
        var userId=localStorage.getItem('userId');
        return "http://10.138.64.19:8080/lightningmortgage/knockoutCheck/"+userId;
        
      }
      knockOutCheck() {
        this.loader = true;
        this.$.knockOutAjax.generateRequest();
        this.$.cover.style.display="none";
        
      }
      knockOutResponse(data) {
        this.loader = false;
        var result= data.detail.response 
        if(result && result.responseCode ==="200") {
          if(result.responseData.knockoutStatus == true) {
            window.history.pushState({}, null, '/property-selection');
            window.dispatchEvent(new CustomEvent('location-changed'));
          }else {
            this.$.validateText.open();
          }
       
        }
        else{
          this.$.validateText.open();
        }
      }
      updateEditProfile(data) {
        this.edit=false;
        this.hide = false;
        this.loader = false;
        var result= data.detail.response
        //let fname = this. 
        if(result && result.status ==="200") {
          this.$.confirmText.open();
        }
        else{
          this.$.validateText.open();
        }
      }
      json(obj) {
        return JSON.stringify(obj, null, 2);
      }

    }

    window.customElements.define(ViewProfile.is, ViewProfile);
  </script>
</dom-module>